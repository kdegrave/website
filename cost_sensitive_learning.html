
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Cost-Sensitive Learning &#8212; Portfolio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'cost_sensitive_learning';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Creating Brochures with LLMs" href="llm_brochure_maker.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/altair-hist.png" class="logo__image only-light" alt="Portfolio - Home"/>
    <img src="_static/altair-hist.png" class="logo__image only-dark pst-js-only" alt="Portfolio - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    About Me
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">LLMs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="llm_brochure_maker.html">Creating Brochures with LLMs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Predictive Modeling</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Cost-Sensitive Learning</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uwdata/visualization-curriculum" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uwdata/visualization-curriculum/issues/new?title=Issue%20on%20page%20%2Fcost_sensitive_learning.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/cost_sensitive_learning.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Cost-Sensitive Learning</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-models">Baseline Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cost-sensitive-modeling">Cost-Sensitive Modeling</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="cost-sensitive-learning">
<h1>Cost-Sensitive Learning<a class="headerlink" href="#cost-sensitive-learning" title="Link to this heading">#</a></h1>
<p>In many real-world classification scenarios, the costs associated with incorrect predictions are asymmetric. This means that the cost of a false positive is different from that of a false negative. Often, one class is less prevalent but holds higher importance than the other, leading to imbalanced datasets. Minimizing these asymmetric costs does not always align perfectly with maximizing metrics like the area under the receiver operating characteristic curve (AUC-ROC) or F1-score. Additionally, relying on a probability threshold of 0.5, the default decision value for most classifiers, may not result in optimal model performance. To address the issue of asymmetric costs, advanced modeling techniques can be employed.</p>
<p>Consider an online retail company planning a direct-mail marketing campaign to promote a new product. The company has compiled purchase histories and demographic information for each customer to target a subset of individuals with offers. From previous campaigns, several factors impact the cost of sending an offer:</p>
<ol class="arabic simple">
<li><p>Design</p></li>
<li><p>Materials</p></li>
<li><p>Printing and production</p></li>
<li><p>Postage and delivery</p></li>
<li><p>Labor and overhead</p></li>
</ol>
<p>Each offer costs <span class="math notranslate nohighlight">\(\$5\)</span> to produce and send. Customers who redeem an offer typically make purchases totaling <span class="math notranslate nohighlight">\(\$50\)</span>. The objective of the campaign is to maximize revenue from redeemed offers while effectively managing costs.</p>
<p>A predictive model will be built using the customer data to identify individuals most likely to redeem an offer and make a purchase. In this retail scenario, the costs associated with misclassification are asymmetric:</p>
<ul class="simple">
<li><p><strong>False Positive (FP):</strong> Sending the offer to someone who will not make a purchase, incurring a <span class="math notranslate nohighlight">\(\$5\)</span> cost.</p></li>
<li><p><strong>False Negative (FN):</strong> Not sending an offer to someone who would have made a purchase, representing a missed opportunity cost of <span class="math notranslate nohighlight">\(\$45\)</span> (the <span class="math notranslate nohighlight">\(\$50\)</span> purchase minus the <span class="math notranslate nohighlight">\(\$5\)</span> offer cost).</p></li>
<li><p><strong>True Positive (TP):</strong> Sending an offer to someone who will make a purchase, incurring a <span class="math notranslate nohighlight">\(\$5\)</span> cost.</p></li>
<li><p><strong>True Negative (TN):</strong> Not sending an offer to someone who would not have made a purchase, incurring <span class="math notranslate nohighlight">\(\$0\)</span> cost.</p></li>
</ul>
<p>The costs can be summarized in the following matrix, where <span class="math notranslate nohighlight">\(N\)</span> represents the number of customers in each classification bucket:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>Actual Negative</p></th>
<th class="head"><p>Actual Positive</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Predicted Negative</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(0N_{tn}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(45N_{fn}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Predicted Positive</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(5N_{fp}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5N_{tp}\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>The total profit can be calculated as:</p>
<div class="math notranslate nohighlight">
\[\textrm{Total Profit} = 50N_{tp} - (5N_{tp} + 5N_{fp} + 45N_{fn})\]</div>
<p>There are several ways to approach the problem of asymmetric costs. Two common methods include:</p>
<ol class="arabic simple">
<li><p><strong>Incorporating Class Weights:</strong> Assigning misclassification costs during training alters the model’s loss function and decision boundary, ensuring greater attention is paid to the more valuable class.</p></li>
<li><p><strong>Threshold Optimization:</strong> After training, optimizing the decision threshold minimizes misclassification costs. This threshold is often different from the standard probability threshold of 0.5.</p></li>
</ol>
<p>Both approaches will be explored in this context.</p>
<p>Let’s get started by importing some useful libraries and loading the data!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">load</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/marketing_campaign.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Education</th>
      <th>Marital Status</th>
      <th>Income</th>
      <th>Num Children in Home</th>
      <th>Num Teens in Home</th>
      <th>Years Customer</th>
      <th>Recency</th>
      <th>Amount Spent Channel 1</th>
      <th>Amount Spent Channel 2</th>
      <th>Amount Spent Channel 3</th>
      <th>Amount Spent Channel 4</th>
      <th>Amount Spent Channel 5</th>
      <th>Amount Spent Channel 6</th>
      <th>Num Deal Purchases</th>
      <th>Num Web Purchases</th>
      <th>Num Catalog Purchases</th>
      <th>Num Store Purchases</th>
      <th>Num Web Visits Month</th>
      <th>Accepted Offer 3</th>
      <th>Accepted Offer 4</th>
      <th>Accepted Offer 5</th>
      <th>Accepted Offer 1</th>
      <th>Accepted Offer 2</th>
      <th>Complaint</th>
      <th>Target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>55.675720</td>
      <td>High School</td>
      <td>Single</td>
      <td>58138.0</td>
      <td>0</td>
      <td>0</td>
      <td>3.323842</td>
      <td>58</td>
      <td>635</td>
      <td>88</td>
      <td>546</td>
      <td>172</td>
      <td>88</td>
      <td>88</td>
      <td>3</td>
      <td>8</td>
      <td>10</td>
      <td>4</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>60.182346</td>
      <td>High School</td>
      <td>Single</td>
      <td>46344.0</td>
      <td>1</td>
      <td>1</td>
      <td>1.817983</td>
      <td>38</td>
      <td>11</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>48.636513</td>
      <td>High School</td>
      <td>Coupled</td>
      <td>71613.0</td>
      <td>0</td>
      <td>0</td>
      <td>2.362830</td>
      <td>26</td>
      <td>426</td>
      <td>49</td>
      <td>127</td>
      <td>111</td>
      <td>21</td>
      <td>42</td>
      <td>1</td>
      <td>8</td>
      <td>2</td>
      <td>10</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30.111707</td>
      <td>High School</td>
      <td>Coupled</td>
      <td>26646.0</td>
      <td>1</td>
      <td>0</td>
      <td>1.889169</td>
      <td>26</td>
      <td>11</td>
      <td>4</td>
      <td>20</td>
      <td>10</td>
      <td>3</td>
      <td>5</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>4</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>33.049502</td>
      <td>Some College</td>
      <td>Married</td>
      <td>58293.0</td>
      <td>1</td>
      <td>0</td>
      <td>1.949403</td>
      <td>94</td>
      <td>173</td>
      <td>43</td>
      <td>118</td>
      <td>46</td>
      <td>27</td>
      <td>15</td>
      <td>5</td>
      <td>5</td>
      <td>3</td>
      <td>6</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The dataset includes demographic information and purchase histories for over two thousand customers. The demographic data include features like age, education level, marital status, and income, offering a comprehensive overview of the customer base. The purchase histories include dollar amounts spent across different product channels, number of purchases through different sales media, and features indicating whether a customer has redeemed other prior offers.</p>
<p>The data are split into training and test sets prior to analysis. The training set, containing 1,563 records, will be used to build the predictive model, while the test set, containing 670 records, will be used to evaluate model performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_tr</span><span class="p">,</span> <span class="n">x_te</span><span class="p">,</span> <span class="n">y_tr</span><span class="p">,</span> <span class="n">y_te</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Target&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">stratify</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_te</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>99
</pre></div>
</div>
</div>
</div>
<p>The test set contains 99 customers who will redeem an offer and make a purchase.</p>
<section id="baseline-models">
<h2>Baseline Models<a class="headerlink" href="#baseline-models" title="Link to this heading">#</a></h2>
<p>The function below will display the costs, revenue gained from purchases, and the total profit for models under different scenarios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_cost_metrics</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">y_actual</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">,</span> <span class="n">max_profit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_profit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">tn</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">exp_r</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">*</span> <span class="n">revenue_sale</span>

    <span class="n">exp_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">*</span> <span class="n">cost_offer</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(</span><span class="n">fp</span> <span class="o">*</span> <span class="n">cost_offer</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(</span><span class="n">fn</span> <span class="o">*</span> <span class="p">(</span><span class="n">revenue_sale</span> <span class="o">-</span> <span class="n">cost_offer</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">max_profit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">max_profit</span> <span class="o">=</span> <span class="p">(</span><span class="n">exp_r</span> <span class="o">-</span> <span class="n">exp_c</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m</span>
<span class="s2">        Revenue: $</span><span class="si">{</span><span class="n">exp_r</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span>
<span class="s2">        Costs: $</span><span class="si">{</span><span class="n">exp_c</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span>
<span class="s2">        Total profit: $</span><span class="si">{</span><span class="p">(</span><span class="n">exp_r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">exp_c</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span>
<span class="s2">        Percent of max: </span><span class="si">{</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">exp_r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">exp_c</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">max_profit</span><span class="si">:</span><span class="s2">0.1f</span><span class="si">}</span><span class="s2">%</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_profit</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="n">exp_r</span> <span class="o">-</span> <span class="n">exp_c</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The cost associated with producing and mailing an offer is \$5, and the average purchase amount upon redeeming an offer is $50. We can set those variables here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cost_offer</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">revenue_sale</span> <span class="o">=</span> <span class="mi">50</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s first use the test set to compute the expected profit from a perfect model. The <strong>Perfect Model</strong> is one in which only customers who will certainly make a purchase are sent an offer. It generates no false positive or false negatives, resulting in the maximum possible revenue through purchases while minimizing costs. In reality, it is never the case where the purchasers are known ahead of time, but the Perfect model will set a limit as to the maximum profit any model could hope to achieve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_profit</span> <span class="o">=</span> <span class="n">compute_cost_metrics</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;Perfect Model&#39;</span><span class="p">,</span> <span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span> <span class="n">y_predict</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span> <span class="n">return_profit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        <span class=" -Color -Color-Bold">Perfect Model</span>
        Revenue: $4,950
        Costs: $495
        Total profit: $4,455
        Percent of max: 100.0%
        
</pre></div>
</div>
</div>
</div>
<p>The Perfect model results in a total profit of \$4,455. Next, a Baseline model can be produced which simply sends an offer to every customer in the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baseline_profit</span> <span class="o">=</span> <span class="n">compute_cost_metrics</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;Baseline Model&#39;</span><span class="p">,</span> <span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span> <span class="n">y_predict</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_te</span><span class="p">)),</span> <span class="n">max_profit</span><span class="o">=</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">return_profit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        <span class=" -Color -Color-Bold">Baseline Model</span>
        Revenue: $4,950
        Costs: $3,350
        Total profit: $1,600
        Percent of max: 35.9%
        
</pre></div>
</div>
</div>
</div>
<p>The <strong>Baseline Model</strong> generates a large revenue but also incurs a very high cost as a result of so many false positives. The total profit is just \$1,600, or 35.9% that of the Perfect model.</p>
<p>Now let’s employ cost-sensitive learning to create models that can generate high revenue but are able to more effectively manage costs. Two models will be built - one with class weights and one without. The models will be incorporated as part of a scikit-learn pipeline. This will allow for the simultaneous one-hot encoding of categorical features, and the scaling of numerical ones when necessary.</p>
</section>
<section id="cost-sensitive-modeling">
<h2>Cost-Sensitive Modeling<a class="headerlink" href="#cost-sensitive-modeling" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_columns</span> <span class="o">=</span> <span class="n">x_tr</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">numerical_columns</span> <span class="o">=</span> <span class="n">x_tr</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;encoder&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;numerical&#39;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_columns</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;categorical&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_columns</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Three model types will be tested here: logistic regression, random forests, and support vector classifiers. Hyperparameters for each will be incorporated in a parameter grid that will be searched using <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>. The models with the best ROC AUC scores for the two class weight scenarioes will be used for analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">class_weight</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">cost_offer</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="n">revenue_sale</span> <span class="o">-</span> <span class="n">cost_offer</span><span class="p">)}</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;classifier&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span>
        <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="s1">&#39;liblinear&#39;</span><span class="p">],</span>
        <span class="s1">&#39;preprocessor__numerical__scaler&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">()]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;classifier&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span>
        <span class="s1">&#39;classifier__criterion&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">],</span>
        <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;classifier&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span>
        <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;classifier__gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">],</span>
        <span class="s1">&#39;classifier__kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;poly&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">],</span>
        <span class="s1">&#39;preprocessor__numerical__scaler&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">()]</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_cv</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">grid_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_tr</span><span class="p">,</span> <span class="n">y_tr</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>The the hyperparameters for the two best-performing models are shown below. The models perform nearly identically in terms of ROC AUC score.</p>
<ul class="simple">
<li><p><strong>Without Class Weights</strong></p>
<ul>
<li><p>Model: SVC(probability=True, class_weight=None)</p></li>
<li><p>C: 16.238</p></li>
<li><p>gamma: ‘auto’</p></li>
<li><p>kernel: ‘rbf’</p></li>
<li><p>scaler: MinMaxScaler()</p></li>
<li><p>AUC score: 0.887
<br/><br/></p></li>
</ul>
</li>
<li><p><strong>With Class Weights</strong></p>
<ul>
<li><p>Model: LogisticRegression(max_iter=500, class_weight={0: 5, 1: 45})</p></li>
<li><p>C: 0.428</p></li>
<li><p>solver: ‘liblinear’</p></li>
<li><p>scaler: MinMaxScaler()</p></li>
<li><p>AUC score: 0.889</p></li>
</ul>
</li>
</ul>
<p>Let’s load the saved models and apply them to the test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_wo</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;models/cost_sensitive_without_class_weight.joblib&#39;</span><span class="p">)</span>

<span class="n">model_wi</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;models/cost_sensitive_with_class_weight.joblib&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predict_wo</span> <span class="o">=</span> <span class="n">model_wo</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_te</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">predict_wi</span> <span class="o">=</span> <span class="n">model_wi</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_te</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The predictions can now be used to examine the expected profit from each model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_cost_metrics</span><span class="p">(</span><span class="s1">&#39;Without Class Weights&#39;</span><span class="p">,</span> <span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span> <span class="n">y_predict</span><span class="o">=</span><span class="p">(</span><span class="n">predict_wo</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">max_profit</span><span class="o">=</span><span class="n">max_profit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        <span class=" -Color -Color-Bold">Without Class Weights</span>
        Revenue: $2,450
        Costs: $2,575
        Total profit: $-125
        Percent of max: -2.8%
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_cost_metrics</span><span class="p">(</span><span class="s1">&#39;With Class Weights&#39;</span><span class="p">,</span> <span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span> <span class="n">y_predict</span><span class="o">=</span><span class="p">(</span><span class="n">predict_wi</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">max_profit</span><span class="o">=</span><span class="n">max_profit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        <span class=" -Color -Color-Bold">With Class Weights</span>
        Revenue: $4,450
        Costs: $1,580
        Total profit: $2,870
        Percent of max: 64.4%
        
</pre></div>
</div>
</div>
</div>
<p>In situations involving imbalanced datasets, relying on the standard decision threshold probability of 0.5 frequently leads to poor predictive performance. This is exemplified by the <strong>Without Class Weights Model</strong> where the total profit is negative, indicating an overall loss. The performance of this model can be improved significantly through proper tuning of the decision threshold.</p>
<p>Conversely, the <strong>With Class Weights Model</strong> performs well with the default classificaiton threshold, yielding a profit reaching 64.4% that of the <strong>Perfect Model</strong>. This is an 80% increase over the <strong>Baseline Model</strong> in which all customers are contacted. Despite this improvement, the performance of this model can also be further optimized through threshold tuning.</p>
<p>Let’s compare the ROC curves for the two models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpr_a</span><span class="p">,</span> <span class="n">tpr_a</span><span class="p">,</span> <span class="n">threshold_a</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_te</span><span class="p">,</span> <span class="n">predict_wo</span><span class="p">)</span>

<span class="n">fpr_b</span><span class="p">,</span> <span class="n">tpr_b</span><span class="p">,</span> <span class="n">threshold_b</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_te</span><span class="p">,</span> <span class="n">predict_wi</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_a</span><span class="p">,</span> <span class="n">tpr_a</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_b</span><span class="p">,</span> <span class="n">tpr_b</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">fpr_a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_a</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_a</span><span class="p">))],</span> <span class="n">fpr_b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_b</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_b</span><span class="p">))]],</span>
         <span class="p">[</span><span class="n">tpr_a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_a</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_a</span><span class="p">))],</span> <span class="n">tpr_b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_b</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_b</span><span class="p">))]],</span> <span class="s1">&#39;xk&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparison of Model ROC Curves&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Baseline Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Model w/o Class Weights&#39;</span><span class="p">,</span> <span class="s1">&#39;Model w/ Class Weights&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/c296f37ce7c41e723e23c36ebe93d5b4283e5f47d15b7beb8f39fc1fea7b64cc.png"><img alt="_images/c296f37ce7c41e723e23c36ebe93d5b4283e5f47d15b7beb8f39fc1fea7b64cc.png" src="_images/c296f37ce7c41e723e23c36ebe93d5b4283e5f47d15b7beb8f39fc1fea7b64cc.png" style="width: 460px; height: 383px;" /></a>
</div>
</div>
<p>The black points on the two curves indicate their approximate elbow. The elbow marks the decision threshold where the true positive rate is maximized and the false positive rate is minimized, and represents the “optimal” model when costs are considered symmetric. Let’s compute the expected profit using these two threshold values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_cost_metrics</span><span class="p">(</span><span class="s1">&#39;Without Class Weights, Optimal ROC Threshold&#39;</span><span class="p">,</span>
                     <span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span>
                     <span class="n">y_predict</span><span class="o">=</span><span class="n">predict_wo</span> <span class="o">&gt;=</span> <span class="n">threshold_a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_a</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_a</span><span class="p">))],</span>
                     <span class="n">max_profit</span><span class="o">=</span><span class="n">max_profit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        <span class=" -Color -Color-Bold">Without Class Weights, Optimal ROC Threshold</span>
        Revenue: $4,350
        Costs: $1,430
        Total profit: $2,920
        Percent of max: 65.5%
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_cost_metrics</span><span class="p">(</span><span class="s1">&#39;With Class Weights, Optimal ROC Threshold&#39;</span><span class="p">,</span>
                     <span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span>
                     <span class="n">y_predict</span><span class="o">=</span><span class="n">predict_wi</span> <span class="o">&gt;=</span> <span class="n">threshold_b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_b</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_b</span><span class="p">))],</span>
                     <span class="n">max_profit</span><span class="o">=</span><span class="n">max_profit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        <span class=" -Color -Color-Bold">With Class Weights, Optimal ROC Threshold</span>
        Revenue: $4,450
        Costs: $1,510
        Total profit: $2,940
        Percent of max: 66.0%
        
</pre></div>
</div>
</div>
</div>
<p>We can see that the <strong>With Class Weights Model</strong> performs only slightly better than before, but the <strong>Without Class Weights Model</strong> shows significant improvement. Both models have now reached an expected profit that is approximately 65% that of the <strong>Perfect Model</strong>.</p>
<p>Finally, we can create a function to compute the expected profit over a series of different thresholds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_profit</span><span class="p">(</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">):</span>

    <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">tn</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">y_predict</span> <span class="o">&gt;=</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">threshold</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="n">exp_r</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">*</span> <span class="n">revenue_sale</span>

    <span class="n">exp_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">*</span> <span class="n">cost_offer</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(</span><span class="n">fp</span> <span class="o">*</span> <span class="n">cost_offer</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(</span><span class="n">fn</span> <span class="o">*</span> <span class="p">(</span><span class="n">revenue_sale</span> <span class="o">-</span> <span class="n">cost_offer</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">exp_r</span> <span class="o">-</span> <span class="n">exp_c</span><span class="p">),</span> <span class="n">threshold</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">profit_wo</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">compute_profit</span><span class="p">(</span><span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span> <span class="n">y_predict</span><span class="o">=</span><span class="n">predict_wo</span><span class="p">)</span>

<span class="n">profit_wi</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">compute_profit</span><span class="p">(</span><span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span> <span class="n">y_predict</span><span class="o">=</span><span class="n">predict_wi</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">baseline_profit</span><span class="o">/</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">baseline_profit</span><span class="o">/</span><span class="n">max_profit</span><span class="p">],</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">profit_wo</span><span class="p">)</span><span class="o">/</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">profit_wi</span><span class="p">)</span><span class="o">/</span><span class="n">max_profit</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">threshold</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">threshold</span> <span class="o">-</span> <span class="n">threshold_a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_a</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_a</span><span class="p">))]))],</span>
          <span class="n">threshold</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">threshold</span> <span class="o">-</span> <span class="n">threshold_b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_b</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_b</span><span class="p">))]))]],</span>
         <span class="p">[</span><span class="n">profit_wo</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">threshold</span> <span class="o">-</span> <span class="n">threshold_a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_a</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_a</span><span class="p">))]))]</span> <span class="o">/</span> <span class="n">max_profit</span><span class="p">,</span>
          <span class="n">profit_wi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">threshold</span> <span class="o">-</span> <span class="n">threshold_b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tpr_b</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fpr_b</span><span class="p">))]))]</span> <span class="o">/</span> <span class="n">max_profit</span><span class="p">],</span> <span class="s1">&#39;xk&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">threshold</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">profit_wo</span><span class="p">))],</span>
          <span class="n">threshold</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">profit_wi</span><span class="p">))]],</span>
         <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">profit_wo</span><span class="p">)</span><span class="o">/</span> <span class="n">max_profit</span><span class="p">,</span>
          <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">profit_wi</span><span class="p">)</span><span class="o">/</span> <span class="n">max_profit</span><span class="p">],</span> <span class="s1">&#39;xr&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">axs</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Proportion of Maximum Profit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Classification Threshold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparison of Model Profit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Baseline Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Model w/o Class Weights&#39;</span><span class="p">,</span> <span class="s1">&#39;Model w/ Class Weights&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/0f966e09aaa9d8a5897cdbdb0dfbda77c30f38706ac81482b7fde40c1f0ea64d.png"><img alt="_images/0f966e09aaa9d8a5897cdbdb0dfbda77c30f38706ac81482b7fde40c1f0ea64d.png" src="_images/0f966e09aaa9d8a5897cdbdb0dfbda77c30f38706ac81482b7fde40c1f0ea64d.png" style="width: 460px; height: 383px;" /></a>
</div>
</div>
<p>We can see that both models reach approximately the same maximum profit but at different classification thresholds. The black points denote the expected profit using the ROC elbow values and the red points mark the maximum possible profit achievable by the models. Let’s see what these maximum profits are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_cost_metrics</span><span class="p">(</span><span class="s1">&#39;Without Class Weights, Optimal Profit Threshold&#39;</span><span class="p">,</span>
                     <span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span>
                     <span class="n">y_predict</span><span class="o">=</span><span class="n">predict_wo</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">profit_wo</span><span class="p">)],</span>
                     <span class="n">max_profit</span><span class="o">=</span><span class="n">max_profit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        <span class=" -Color -Color-Bold">Without Class Weights, Optimal Profit Threshold</span>
        Revenue: $4,900
        Costs: $1,605
        Total profit: $3,295
        Percent of max: 74.0%
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_cost_metrics</span><span class="p">(</span><span class="s1">&#39;With Class Weights, Optimal Profit Threshold&#39;</span><span class="p">,</span>
                     <span class="n">y_actual</span><span class="o">=</span><span class="n">y_te</span><span class="p">,</span>
                     <span class="n">y_predict</span><span class="o">=</span><span class="n">predict_wi</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">profit_wi</span><span class="p">)],</span>
                     <span class="n">max_profit</span><span class="o">=</span><span class="n">max_profit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        <span class=" -Color -Color-Bold">With Class Weights, Optimal Profit Threshold</span>
        Revenue: $4,850
        Costs: $1,635
        Total profit: $3,215
        Percent of max: 72.2%
        
</pre></div>
</div>
</div>
</div>
<p>The <strong>Without Class Weights Model</strong> achieves a profit that is over twice the profit of the <strong>Baseline Model</strong>, reaching 74% that of the <strong>Perfect Model</strong>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="llm_brochure_maker.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Creating Brochures with LLMs</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-models">Baseline Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cost-sensitive-modeling">Cost-Sensitive Modeling</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kyle DeGrave
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>